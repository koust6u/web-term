<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="../css/common.css">
  <link rel="stylesheet" type="text/css" href="../css/tic-tac-to.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Hi+Melody&display=swap');
  </style>
  <!-- 
    --tic-tac-to 게임 대한 java Script코드--
    1. table 기능 활용 -> 3 x 3 table 각각의 td를 tic-tac-to의 칸으로 활용하여 게임을 만들었습니다.
    2. 설명 -> 컨셉은 컴퓨터와  tic-tac-to 게임을 하여 승무패를 가리는 방식입니다. 실제 컴퓨터 턴에는 
      별다른 로직이 없이 난수를 생성하여 modular연산을 통해 무작위로 선택되지 않은 칸에 대해 선택하는 방식입니다.
      먼저 가로,세로, 대각 중에 3칸을 채우는 쪽이 이기는 식의 게임입니다. 단 아무도 한줄을 채우지 못하면 무승부입니다.
  -->
  <script>
    let board = [[0,0,0], [0,0,0], [0,0,0]]; // 0: 빈 칸, 1: 사용자(O), 2: 컴퓨터(X)
    let turn = 1; // 사용자의 턴부터 시작
    let gameover = false;

    function play(row, col) {
      // binding error가 있어 embed 방식으로 함수 구현  
        if (board[row][col] != 0 || gameover) return; // 이미 선택한 칸이거나 게임이 종료된 경우 무시
        board[row][col] = turn;
        document.getElementById(`${row}-${col}`).innerText = turn == 1 ? 'O' : 'X';
        document.getElementById(`${row}-${col}`).src = turn == 1 ? "../images/o.png" : '../images/x.png';

        if (checkWin(turn)) {
          alert(turn == 1 ? '사용자(O) 승리!' : '컴퓨터(X) 승리!');
          gameover = true;
          return;
        }
        if (checkDraw()) {
          alert('무승부!');
          gameover = true;
          return;
        }
        turn = turn == 1 ? 2 : 1; // 턴 변경
        if (turn == 2) {
          // 컴퓨터 턴
          setTimeout(() => {
            let row, col;
            do {
              row = Math.floor(Math.random() * 3);
              col = Math.floor(Math.random() * 3);
            } while (board[row][col] != 0);
            play(row, col);
          }, 500);
        }  
    };

  /*
  reset 함수는 게임이 끝나거나 사용자가 처음부터 게임을 다시 하고 싶을때 호출 되는 함수입니다.
  이 함수가 호출되면 td에 채워진 o나 x 에 대한 이미지들이 모두 지워지고 게임의 흐름이 초기화되어 다시 
  시작되는 방식입니다.
  */
  function reset() {
    board = [[0,0,0], [0,0,0], [0,0,0]];
    turn = 1;
    gameover = false;
    for (let i = 0; i < 3; i++) {
      for (let j = 0; j < 3; j++) {
        document.getElementById(i+'-'+j).innerText = '';
        document.getElementById(i+'-'+j).src= '../images/default.png';
      }
    }
  }
  /*
  세로, 가로 , 대각선을 먼저 채우면 이기는 게임 규칙 때문에 매 턴이 끝나면 checkwin 함수가 호출되어
  세로, 가로, 대각선에 대해 먼저 채우진 쪽이 있는지 확인하는 함수 입니다.
  */
  function checkWin(player) {
  for (let i = 0; i < 3; i++) {
      if (board[i][0] == player && board[i][1] == player && board[i][2] == player) return true; // 가로 체크
      if (board[0][i] == player && board[1][i] == player && board[2][i] == player) return true; // 세로 체크
    }
  if (board[0][0] == player && board[1][1] == player && board[2][2] == player) return true; // 대각선 체크
  if (board[0][2] == player && board[1][1] == player && board[2][0] == player) return true; // 대각선 체크
  return false;
  }
  
  /*
  무승부를 확인하는 함수이지만 실제로는 모든 같이 채워져잇따면 true반환하여 더 이상 게임 진행이
  불가능 한경우를 체크하는 기능을 합니다.
  */
  function checkDraw() {
    for (let i = 0; i < 3; i++) {
      for (let j = 0; j < 3; j++) {
      if (board[i][j] == 0) return false; // 빈 칸이 있는 경우 게임 계속
      }
    }
    return true; 
  }
  
  </script>
  </head>
  <body>
    <!-- Semantic 사용 (header)-->
    <header>
      <!-- Semantic 사용 (nav)-->
      <nav>
        <div>
          <a href="./home.html"><img class="logo" src="../images/free-icon-alien-6542680.png" alt="logo"></a>
        </div>
        <!-- list 사용!-->
        <ul>
          <li><a href="./home.html">Home</a></li>
          <li><a href="./about.html">About</a></li>
          <li><a href="./guest-book.html">Guest-book</a></li>
          <li class="dropdown">
            <a href="#">PlayGround</a>
            <div class="dropdown-content">
              <a href="./calculator.html">계산기</a>
              <a href="./chat-bot.html">챗봇</a>
              <a href="./today-info.html">우주상식</a>
              <a href="./tic-tac-to.html">게임</a>
            </div>
          </li>
        </ul>
      </nav>
    </header>
    <main id="game-main">
      <h2>틱-택-토 게임!</h2>
      <table>
        <tr>
          <td onclick="play(0, 0)"><img id="0-0" src="../images/default.png"></td>
          <td onclick="play(0, 1)"><img id="0-1" src="../images/default.png"></td>
          <td onclick="play(0, 2)"><img id="0-2" src="../images/default.png"></td>
        </tr>
        <tr>
          <td onclick="play(1, 0)"><img id="1-0" src="../images/default.png"></td>
          <td onclick="play(1, 1)"><img id="1-1" src="../images/default.png"></td>
          <td onclick="play(1, 2)"><img id="1-2" src="../images/default.png"></td>
        </tr>
        <tr>
          <td onclick="play(2, 0)"><img id="2-0" src="../images/default.png"></td>
          <td onclick="play(2, 1)"><img id="2-1" src="../images/default.png"></td>
          <td onclick="play(2, 2)"><img id="2-2" src="../images/default.png"></td>
        </tr>
      </table>
      <br>
  
        <div class="gif-container" onclick="reset()">다시하기</div>
    </main>
    <!-- Semantic 사용 (footer)-->
    <footer>
      <hr>
      <div class="footer-container">
        <img src="../images/free-icon-alien-6542680.png" alt="외계인 프로필 이미지">
        <div class="footer-text">
          <p>이 블로그는 외계인이 운영합니다.</p>
          <p>여러분은 외계인의 일상을 엿볼 수 있습니다.</p>
          <p>문의: <a href="https://github.com/koust6u">koust6u@github.com</a></p>
          <p>&copy; 2023 Alien Blog. All Rights Reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>